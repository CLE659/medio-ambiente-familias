<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pequeños Guardianes - Instituto San Francisco de Asís</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #e7f0e7;
    margin: 0; padding: 0;
    color: #2a4d2a;
  }
  header {
    text-align: center;
    padding: 20px 10px 10px;
  }
  header .cover-img {
    width: 210mm;
    height: 297mm;
    background: #cde7cd url('https://via.placeholder.com/595x842?text=Foto+de+la+familia+del+peque%C3%B1o+guardi%C3%A1n') center center no-repeat;
    background-size: contain;
    margin: 0 auto 15px;
    border: 2px solid #94bc94;
    border-radius: 8px;
  }
  header h1 {
    font-size: 1.8rem;
    margin: 0 0 8px;
  }
  header .welcome {
    font-size: 1.1rem;
    line-height: 1.4;
    max-width: 600px;
    margin: 0 auto;
  }
  main {
    max-width: 800px;
    margin: 20px auto;
    background: #f0f9f0;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 0 15px rgba(0,0,0,0.1);
  }
  h2 {
    color: #3a693a;
    border-bottom: 2px solid #7bbb7b;
    padding-bottom: 5px;
  }
  section.challenge {
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 1px solid #aacbaa;
  }
  label {
    display: block;
    margin: 10px 0 5px;
  }
  input[type="file"] {
    display: block;
    margin-bottom: 10px;
  }
  button {
    background: #5ca05c;
    border: none;
    color: white;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    transition: background 0.3s ease;
  }
  button:disabled {
    background: #a5d1a5;
    cursor: not-allowed;
  }
  button:hover:not(:disabled) {
    background: #4b864b;
  }
  .message {
    margin: 10px 0 0;
    font-weight: 700;
    color: #2a7f2a;
    font-size: 1.1rem;
  }
  .hidden {
    display: none;
  }
  #congrats {
    text-align: center;
    font-size: 1.5rem;
    margin: 20px 0;
    color: #277227;
  }
  #mission-complete {
    margin-top: 30px;
  }
  #mission-complete h2 {
    margin-bottom: 15px;
  }
  #gallery {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    justify-content: center;
  }
  #gallery img, #gallery video {
    max-width: 180px;
    border-radius: 8px;
    border: 2px solid #7bbc7b;
  }
  #diploma {
    display: block;
    margin: 30px auto 10px;
    max-width: 400px;
    border: 3px solid #4a7a4a;
    border-radius: 10px;
  }
  #download-diploma {
    display: block;
    margin: 0 auto 40px;
    background: #3a6a3a;
  }
</style>
</head>
<body>

<header>
  <div class="cover-img" aria-label="Foto de la familia del pequeño guardián"></div>
  <h1>Instituto San Francisco de Asís</h1>
  <p class="welcome">
    Bienvenidos a Cuidando el medio ambiente en familia<br />
    Gracias por sumarte a los pequeños guardianes para cuidar nuestro planeta.
  </p>
</header>

<main>

  <section class="challenge" id="challenge1">
    <h2>Desafío 1: Juguete reciclable</h2>
    <p>Crear un juguete con materiales reciclables y subir una imagen.</p>
    <label for="file1">Subir imagen:</label>
    <input type="file" id="file1" accept="image/*" />
    <button id="submit1" disabled>Enviar</button>
    <p class="message" id="msg1"></p>
  </section>

  <section class="challenge hidden" id="challenge2">
    <h2>Desafío 2: Dibujo medio ambiente</h2>
    <p>Realizar un dibujo donde se visualice un medioambiente limpio y uno sucio y subir la imagen.</p>
    <label for="file2">Subir imagen:</label>
    <input type="file" id="file2" accept="image/*" />
    <button id="submit2" disabled>Enviar</button>
    <p class="message" id="msg2"></p>
  </section>

  <section class="challenge hidden" id="challenge3">
    <h2>Desafío 3: Vídeo en familia</h2>
    <p>Crear un vídeo corto en familia explicando por qué es importante cuidar el medio ambiente.</p>
    <label for="file3">Subir vídeo:</label>
    <input type="file" id="file3" accept="video/*" />
    <button id="submit3" disabled>Enviar</button>
    <p class="message" id="msg3"></p>
  </section>

  <div id="congrats" class="hidden">
    <p>¡Felicitaciones! Una familia abrazando a un planeta tierra feliz.</p>
    <img src="https://i.imgur.com/ClxZf8y.png" alt="Familia abrazando planeta feliz" width="200" />
  </div>

  <section id="mission-complete" class="hidden">
    <h2>Misión Completa Guardianes</h2>
    <div id="gallery" aria-live="polite"></div>
    <img id="diploma" src="https://i.imgur.com/DvYErRl.png" alt="Diploma Pequeños Guardianes" />
    <button id="download-diploma">Descargar Diploma</button>
  </section>

</main>

<script>
  // Helper function para habilitar botón cuando hay archivo
  function setupFileInput(fileInputId, submitButtonId, messageId) {
    const fileInput = document.getElementById(fileInputId);
    const submitButton = document.getElementById(submitButtonId);
    const message = document.getElementById(messageId);

    fileInput.addEventListener('change', () => {
      submitButton.disabled = !fileInput.files.length;
      message.textContent = '';
    });
  }

  // Guardar archivos en localStorage como URL para simular subida
  function readFileAsDataURL(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.onerror = () => reject('Error leyendo archivo');
      reader.readAsDataURL(file);
    });
  }

  // Estado de los desafíos completados
  let challengesCompleted = JSON.parse(localStorage.getItem('challengesCompleted')) || {
    1: false,
    2: false,
    3: false
  };

  // Función para mostrar siguiente desafío y guardar estado
  function unlockChallenge(num) {
    if (num === 1) {
      challengesCompleted[1] = true;
      document.getElementById('challenge2').classList.remove('hidden');
    } else if (num === 2) {
      challengesCompleted[2] = true;
      document.getElementById('challenge3').classList.remove('hidden');
    } else if (num === 3) {
      challengesCompleted[3] = true;
      document.getElementById('mission-complete').classList.remove('hidden');
    }
    localStorage.setItem('challengesCompleted', JSON.stringify(challengesCompleted));
  }

  // Actualizar botón enviar y mensajes para cada desafío
  function setupChallenge(challengeNum, inputId, buttonId, messageId, isVideo = false) {
    const input = document.getElementById(inputId);
    const button = document.getElementById(buttonId);
    const message = document.getElementById(messageId);

    setupFileInput(inputId, buttonId, messageId);

    button.addEventListener('click', async () => {
      if (!input.files.length) return;

      const file = input.files[0];

      if (isVideo && !file.type.startsWith('video/')) {
        message.textContent = 'Por favor subí un archivo de vídeo válido.';
        return;
      }
      if (!isVideo && !file.type.startsWith('image/')) {
        message.textContent = 'Por favor subí un archivo de imagen válido.';
        return;
      }

      try {
        const dataUrl = await readFileAsDataURL(file);

        // Guardamos el archivo en localStorage para la galería simulada
        const galleryData = JSON.parse(localStorage.getItem('galleryData')) || [];
        galleryData.push({
          type: isVideo ? 'video' : 'image',
          src: dataUrl,
          challenge: challengeNum
        });
        localStorage.setItem('galleryData', JSON.stringify(galleryData));

        message.textContent = '¡Archivo subido con éxito!';
        button.disabled = true;
        input.disabled = true;

        unlockChallenge(challengeNum);

        showCongrats();

        if (challengesCompleted[1] && challengesCompleted[2] && challengesCompleted[3]) {
          renderGallery();
        }

      } catch (err) {
        message.textContent = 'Error leyendo el archivo.';
      }
    });
  }

  function showCongrats() {
    const congratsDiv = document.getElementById('congrats');
    congratsDiv.classList.remove('hidden');
    setTimeout(() => {
      congratsDiv.classList.add('hidden');
    }, 5000);
  }

  function renderGallery() {
    const galleryDiv = document.getElementById('gallery');
    galleryDiv.innerHTML = '';
    const galleryData = JSON.parse(localStorage.getItem('galleryData')) || [];

    galleryData.forEach(item => {
      if (item.type === 'image') {
        const img = document.createElement('img');
        img.src = item.src;
        img.alt = 'Imagen subida en desafío';
        galleryDiv.appendChild(img);
      } else if (item.type === 'video') {
        const video = document.createElement('video');
        video.src = item.src;
        video.controls = true;
        video.width = 180;
        galleryDiv.appendChild(video);
      }
    });
  }

  // Descargar diploma como PNG
  document.getElementById('download-diploma').addEventListener('click', () => {
    const diplomaUrl = document.getElementById('diploma').src;
    const a = document.createElement('a');
    a.href = diplomaUrl;
    a.download = 'diploma_pequenos_guardianes.png';
    a.click();
  });

  // Inicialización
  window.addEventListener('load', () => {
    // Restaurar estado desafíos para mostrar los desbloqueados
    if (challengesCompleted[1]) document.getElementById('challenge2').classList.remove('hidden');
    if (challengesCompleted[2]) document.getElementById('challenge3').classList.remove('hidden');
    if (challengesCompleted[3]) document.getElementById('mission-complete').classList.remove('hidden');

    // Si ya hay archivos subidos y desafíos completos, mostrar galería
    if (challengesCompleted[3]) renderGallery();

    // Configurar desafíos
    setupChallenge(1, 'file1', 'submit1', 'msg1');
    setupChallenge(2, 'file2', 'submit2', 'msg2');
    setupChallenge(3, 'file3', 'submit3', 'msg3', true);
  });
</script>

</body>
                                      </html><!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pequeños Guardianes - Instituto San Francisco de Asís</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #e7f0e7;
    margin: 0; padding: 0;
    color: #2a4d2a;
  }
  header {
    text-align: center;
    padding: 20px 10px 10px;
  }
  header .cover-img {
    width: 210mm;
    height: 297mm;
    background: #cde7cd url('https://via.placeholder.com/595x842?text=Foto+de+la+familia+del+peque%C3%B1o+guardi%C3%A1n') center center no-repeat;
    background-size: contain;
    margin: 0 auto 15px;
    border: 2px solid #94bc94;
    border-radius: 8px;
  }
  header h1 {
    font-size: 1.8rem;
    margin: 0 0 8px;
  }
  header .welcome {
    font-size: 1.1rem;
    line-height: 1.4;
    max-width: 600px;
    margin: 0 auto;
  }
  main {
    max-width: 800px;
    margin: 20px auto;
    background: #f0f9f0;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 0 15px rgba(0,0,0,0.1);
  }
  h2 {
    color: #3a693a;
    border-bottom: 2px solid #7bbb7b;
    padding-bottom: 5px;
  }
  section.challenge {
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 1px solid #aacbaa;
  }
  label {
    display: block;
    margin: 10px 0 5px;
  }
  input[type="file"] {
    display: block;
    margin-bottom: 10px;
  }
  button {
    background: #5ca05c;
    border: none;
    color: white;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    transition: background 0.3s ease;
  }
  button:disabled {
    background: #a5d1a5;
    cursor: not-allowed;
  }
  button:hover:not(:disabled) {
    background: #4b864b;
  }
  .message {
    margin: 10px 0 0;
    font-weight: 700;
    color: #2a7f2a;
    font-size: 1.1rem;
  }
  .hidden {
    display: none;
  }
  #congrats {
    text-align: center;
    font-size: 1.5rem;
    margin: 20px 0;
    color: #277227;
  }
  #mission-complete {
    margin-top: 30px;
  }
  #mission-complete h2 {
    margin-bottom: 15px;
  }
  #gallery {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    justify-content: center;
  }
  #gallery img, #gallery video {
    max-width: 180px;
    border-radius: 8px;
    border: 2px solid #7bbc7b;
  }
  #diploma {
    display: block;
    margin: 30px auto 10px;
    max-width: 400px;
    border: 3px solid #4a7a4a;
    border-radius: 10px;
  }
  #download-diploma {
    display: block;
    margin: 0 auto 40px;
    background: #3a6a3a;
  }
</style>
</head>
<body>

<header>
  <div class="cover-img" aria-label="Foto de la familia del pequeño guardián"></div>
  <h1>Instituto San Francisco de Asís</h1>
  <p class="welcome">
    Bienvenidos a Cuidando el medio ambiente en familia<br />
    Gracias por sumarte a los pequeños guardianes para cuidar nuestro planeta.
  </p>
</header>

<main>

  <section class="challenge" id="challenge1">
    <h2>Desafío 1: Juguete reciclable</h2>
    <p>Crear un juguete con materiales reciclables y subir una imagen.</p>
    <label for="file1">Subir imagen:</label>
    <input type="file" id="file1" accept="image/*" />
    <button id="submit1" disabled>Enviar</button>
    <p class="message" id="msg1"></p>
  </section>

  <section class="challenge hidden" id="challenge2">
    <h2>Desafío 2: Dibujo medio ambiente</h2>
    <p>Realizar un dibujo donde se visualice un medioambiente limpio y uno sucio y subir la imagen.</p>
    <label for="file2">Subir imagen:</label>
    <input type="file" id="file2" accept="image/*" />
    <button id="submit2" disabled>Enviar</button>
    <p class="message" id="msg2"></p>
  </section>

  <section class="challenge hidden" id="challenge3">
    <h2>Desafío 3: Vídeo en familia</h2>
    <p>Crear un vídeo corto en familia explicando por qué es importante cuidar el medio ambiente.</p>
    <label for="file3">Subir vídeo:</label>
    <input type="file" id="file3" accept="video/*" />
    <button id="submit3" disabled>Enviar</button>
    <p class="message" id="msg3"></p>
  </section>

  <div id="congrats" class="hidden">
    <p>¡Felicitaciones! Una familia abrazando a un planeta tierra feliz.</p>
    <img src="https://i.imgur.com/ClxZf8y.png" alt="Familia abrazando planeta feliz" width="200" />
  </div>

  <section id="mission-complete" class="hidden">
    <h2>Misión Completa Guardianes</h2>
    <div id="gallery" aria-live="polite"></div>
    <img id="diploma" src="https://i.imgur.com/DvYErRl.png" alt="Diploma Pequeños Guardianes" />
    <button id="download-diploma">Descargar Diploma</button>
  </section>

</main>

<script>
  // Helper function para habilitar botón cuando hay archivo
  function setupFileInput(fileInputId, submitButtonId, messageId) {
    const fileInput = document.getElementById(fileInputId);
    const submitButton = document.getElementById(submitButtonId);
    const message = document.getElementById(messageId);

    fileInput.addEventListener('change', () => {
      submitButton.disabled = !fileInput.files.length;
      message.textContent = '';
    });
  }

  // Guardar archivos en localStorage como URL para simular subida
  function readFileAsDataURL(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.onerror = () => reject('Error leyendo archivo');
      reader.readAsDataURL(file);
    });
  }

  // Estado de los desafíos completados
  let challengesCompleted = JSON.parse(localStorage.getItem('challengesCompleted')) || {
    1: false,
    2: false,
    3: false
  };

  // Función para mostrar siguiente desafío y guardar estado
  function unlockChallenge(num) {
    if (num === 1) {
      challengesCompleted[1] = true;
      document.getElementById('challenge2').classList.remove('hidden');
    } else if (num === 2) {
      challengesCompleted[2] = true;
      document.getElementById('challenge3').classList.remove('hidden');
    } else if (num === 3) {
      challengesCompleted[3] = true;
      document.getElementById('mission-complete').classList.remove('hidden');
    }
    localStorage.setItem('challengesCompleted', JSON.stringify(challengesCompleted));
  }

  // Actualizar botón enviar y mensajes para cada desafío
  function setupChallenge(challengeNum, inputId, buttonId, messageId, isVideo = false) {
    const input = document.getElementById(inputId);
    const button = document.getElementById(buttonId);
    const message = document.getElementById(messageId);

    setupFileInput(inputId, buttonId, messageId);

    button.addEventListener('click', async () => {
      if (!input.files.length) return;

      const file = input.files[0];

      if (isVideo && !file.type.startsWith('video/')) {
        message.textContent = 'Por favor subí un archivo de vídeo válido.';
        return;
      }
      if (!isVideo && !file.type.startsWith('image/')) {
        message.textContent = 'Por favor subí un archivo de imagen válido.';
        return;
      }

      try {
        const dataUrl = await readFileAsDataURL(file);

        // Guardamos el archivo en localStorage para la galería simulada
        const galleryData = JSON.parse(localStorage.getItem('galleryData')) || [];
        galleryData.push({
          type: isVideo ? 'video' : 'image',
          src: dataUrl,
          challenge: challengeNum
        });
        localStorage.setItem('galleryData', JSON.stringify(galleryData));

        message.textContent = '¡Archivo subido con éxito!';
        button.disabled = true;
        input.disabled = true;

        unlockChallenge(challengeNum);

        showCongrats();

        if (challengesCompleted[1] && challengesCompleted[2] && challengesCompleted[3]) {
          renderGallery();
        }

      } catch (err) {
        message.textContent = 'Error leyendo el archivo.';
      }
    });
  }

  function showCongrats() {
    const congratsDiv = document.getElementById('congrats');
    congratsDiv.classList.remove('hidden');
    setTimeout(() => {
      congratsDiv.classList.add('hidden');
    }, 5000);
  }

  function renderGallery() {
    const galleryDiv = document.getElementById('gallery');
    galleryDiv.innerHTML = '';
    const galleryData = JSON.parse(localStorage.getItem('galleryData')) || [];

    galleryData.forEach(item => {
      if (item.type === 'image') {
        const img = document.createElement('img');
        img.src = item.src;
        img.alt = 'Imagen subida en desafío';
        galleryDiv.appendChild(img);
      } else if (item.type === 'video') {
        const video = document.createElement('video');
        video.src = item.src;
        video.controls = true;
        video.width = 180;
        galleryDiv.appendChild(video);
      }
    });
  }

  // Descargar diploma como PNG
  document.getElementById('download-diploma').addEventListener('click', () => {
    const diplomaUrl = document.getElementById('diploma').src;
    const a = document.createElement('a');
    a.href = diplomaUrl;
    a.download = 'diploma_pequenos_guardianes.png';
    a.click();
  });

  // Inicialización
  window.addEventListener('load', () => {
    // Restaurar estado desafíos para mostrar los desbloqueados
    if (challengesCompleted[1]) document.getElementById('challenge2').classList.remove('hidden');
    if (challengesCompleted[2]) document.getElementById('challenge3').classList.remove('hidden');
    if (challengesCompleted[3]) document.getElementById('mission-complete').classList.remove('hidden');

    // Si ya hay archivos subidos y desafíos completos, mostrar galería
    if (challengesCompleted[3]) renderGallery();

    // Configurar desafíos
    setupChallenge(1, 'file1', 'submit1', 'msg1');
    setupChallenge(2, 'file2', 'submit2', 'msg2');
    setupChallenge(3, 'file3', 'submit3', 'msg3', true);
  });
</script>

</body>
    </html>
